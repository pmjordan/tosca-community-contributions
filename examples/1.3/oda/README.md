This project represents an attempt to use TOSCA as a method of specifying and deploying TMForum ODA Components. The project is now suspended as TMForum documents TR290 and TMF921A may superceed this approach.

## ODA Components
TMForum.org have a concept called Open Digital Architecture (ODA) within this are specified a number of functional components each of which is self describing (via a spec.yaml file) and provides one or more REST APIs while depending on one or more REST APIs. See https://www.tmforum.org/oda/implementation/technical-architecture-components/


## TOSCA
OASIS TOSCA provides a standard syntax in which to express (among other things) intent for cloud deployments and so appears to be a good fit for describing how to assemble a set of ODA components into a system. See https://www.oasis-open.org/committees/documents.php?wg_abbrev=tosca&show_descriptions=yes

## Ubicity

There are a number of tools which implement TOSCA, ( see https://github.com/philippemerle/tosca-implementation-landscape) and for convenience of programming and investigation it is necessary to select one. For this project I use Ubicity which is on a private github repo https://github.com/lauwers/ubicity

## Ubicity TOSCA profiles
The easiest way to use Ubicity is by extending the scripts, directory structure, TOSCA files and profiles provided in the private repo https://github.com/lauwers/tosca and so this repo started as a clone of that.

## Approach in this project

V1.0 ODA components were deployed as custom resources within a Kubernetes environment. V2 still uses Kubernetes, at least as a demonstration of a possible implementation, but the deployment method is somewhat different. One reference implementation of a suitable platform for deploying components is https://github.com/tmforum-oda/canvas-in-a-bottle

This project attempts to allow deployment of the selected components to a K8s environment, including canvas in a bottle, but it is important that the chosen TOSCA structure allows for deployment to other environments should they be identified in the future.

ODA has a demonstrator platform called 'canvas' and so this project has an equivalent called 'sailcloth'. Sailcloth is used to emulate an arbitrary deployment platform which is not canvas or K8s.

It is fair to assume that deployment to any platform / execution environment will be by executing a Linux command. Therefore it is reasonable to construct Sailcloth to simply be a set of directories and files. This had the added advantage of decoupling much of the testing of the TOSCA profiles from the difficulties of running one or more kubernetes environments.

Sailcloth is a Linux folder. Each component deployed to sailcloth results in a directory with a name of that component. Within that directory are two YAML files, one is the spec.yaml file taken directly from the supplied component definition. The other file is connections.yaml, this lists the APIs on which the component depends, and crucially, a URL of the component instance which, in this deployed system, provides this API. It is this knitting together of a requirement of one component with the capability of another component which turns the collection of deployments into a system.

## How ubicity was used to achieve the result

### Profiles

#### TMForum
The profiles directory supplied by https://github.com/lauwers/tosca was enhanced by adding the ./org/tmforum/1.0 directory
This directory contains information which is common to any TOSCA use of ODA components. Ideally it would be machine generated by tooling supplied by TMForum based on data which they already hold in machine readable form.

The most important file is profile.yaml.

profile.yaml imports apis.yaml
        
apis.yaml lists all the APIs defined by TMForum and used by ODA components. It could easily be machine generated from existing TMForum data

profile.yaml also lists all the ODA components as TOSCA node type definitions. They could also be machine generated form TMForum data.
    
In addition profile.yaml defines some types which remain the same regardless of the TMForum data, these include:
- a parent node type for ODA component,
- Requirement and capability types which are used by that parent.

- Also included are type definitions to represent canvas and sailcloth although it might be possible to separate these into separate files to improve modularity. Note that of course TOSCA can be used to deploy the canvas and sailcloth platforms as well as deploying the ODA components on those platforms

The artifacts directory contains scripts to create and delete the resources defined in the profile. This follows the standard directory structure used by Ubicity. Ubicity support for delete operations is understood to have some issues.

#### Vendors
Component vendors would supply profiles which extend the TMForum profile and describe their particular implementation of one or more ODA components. This would include defining a dependency on a particular platform, e.g. Canvas or sailcloth.
Examples are given in ./com/sigscale and ./com/vodafone


### Services

The ubicity supplied services directory has been enhanced by adding some services which make use of the profiles mentioned above. Such services would be created by devops people within Communications Service Providers, not by TMForum or software vendors. There are services which use components which run on canvas and others which are deployed on sailcloth.
For example ODAcomponents_dependant.yaml deploys two components on sailcloth where one depends on an API provided by the other. The sailcloth directory holds the result.

### Diagrams

TMForum sometimes uses diagrams to show the API dependencies between ODA components commonly used in combination, see for example https://projects.tmforum.org/wiki/display/TAC/Components+Interactions+in+Core+Commerce+Management. There are tools which can create a diagram given a TOSCA service template. It would appear possible then to create a TOSCA template of teh TMForum system and automatically generate a diagram form it. This was tested using the service template ODACoreCommerceManagement.yaml
This template is somewhat strange in that it does not require any deployment artifacts and does not refer to any commercially provided component implementations. Therefore some aspects are set to null. The resultant diagrams are held in diagrams/ODACoreCommerceManagement.


# Conclusions
This could be done. It does require using some features of TOSCA 2.0 and there is a long list of things to do and try but the concept is sound. whether the concept is applicable given other emerging work in TMForum is debatable.





